# SimpleTuner v2.1 से v2.2 माइग्रेशन गाइड

यह गाइड आपको SimpleTuner v2.1 से v2.2 में माइग्रेट करने में मदद करती है, जिसमें नया command-line interface शामिल है जो configuration management और training jobs चलाने के लिए एक one-stop entry-point है।

## v2.2 में नया क्या है

- **pip से इंस्टॉल होने वाला पैकेज**: SimpleTuner अब Python पैकेज के रूप में इंस्टॉल किया जा सकता है
- **Unified CLI entry point**: `simpletuner` कमांड सीधे script execution को रिप्लेस करता है
  - `simpletuner examples` - उदाहरण configs की सूची देता है और workspace में कॉपी करने देता है
  - `simpletuner configure` - टर्मिनल UI के जरिए इंटरैक्टिव रूप से पूरी तरह कस्टम config फाइलें बनाता/संशोधित करता है, Linux kernel के `make menuconfig` जैसा
  - `simpletuner train` - config और CLI overrides के साथ training चलाता है
- **Command-line argument overrides**: तेज़ बदलाव के लिए config files संपादित किए बिना arguments पास करें, जैसे `simpletuner train env=foo learning_rate=5e-5`

### क्या संगत रहता है

- मौजूदा `train.sh` workflow काम करता है
  - नए `simpletuner/` सबडायरेक्टरी में पहले `cd` करना न भूलें।
- Config file formats और contents (JSON, TOML, ENV) बिना बदलाव
- Dataset configurations वही हैं
- Model training parameters वही हैं
- Model implementations समान हैं

## इंस्टॉलेशन विधियाँ

### v2.2 (Pip Install Method) - आधुनिक सिफारिश

अब जब `pip` इंस्टॉलेशन समर्थित है, तो सुझाई गई विधि यह है कि SimpleTuner को नए workspace में पैकेज के रूप में इंस्टॉल करें। इससे आपकी training परियोजनाओं को SimpleTuner codebase से साफ़ अलगाव मिलता है, और `pip install --upgrade simpletuner` के जरिए आसान अपडेट संभव होते हैं।

```bash
# Install SimpleTuner package
pip install 'simpletuner[cuda]' # या cuda13 (Blackwell/B-series), apple, rocm (या CPU के लिए कुछ नहीं)

# Create training workspace
mkdir my_training_project
cd my_training_project

# Initialize config structure
mkdir -p config/sdxl_example_project

# Interactively create a configuration
simpletuner configure config/sdxl_example_project/config.json
## OR - copy an example
# simpletuner examples list # list available examples to select from
# simpletuner examples copy sdxl.lycoris-lokr config/sdxl_example_project
## कॉपी किए गए config file में paths और parameters अपडेट करना न भूलें!

# Run training
simpletuner env=sdxl_example_project
```

### Git clone के जरिए (legacy method)

पिछले रिलीज़ में सुझाई गई विधि रिपॉज़िटरी को clone करके सीधे training scripts चलाना था। यह ही एक समर्थित तरीका था और इसमें कई कमियाँ थीं। फिर भी, backward compatibility के लिए यह workflow v2.2 में पूरी तरह समर्थित है।

**नोट:** `poetry` अब उपयोग नहीं किया जाता।

```bash
# Clone repository
git clone --branch=release https://github.com/bghira/SimpleTuner.git
cd SimpleTuner

# Install dependencies with Pip now instead of Poetry
pip install '.[cuda]'  # या .[apple], या .[rocm]

# Run training - यह अभी भी काम करता है, और आगे भी करेगा।
ENV=my_config train.sh
## या train.py स्क्रिप्ट सीधे उपयोग करें, जो भविष्य में समर्थित न रहे:
#python train.py --model_family=flux --learning_rate=1e-4
```

## Command-Line Interface माइग्रेशन

### Configuration Loading

#### v2.1 Workflow

```bash
# Set environment variable
export ENV=my_config

# Config loaded from: config/my_config/config.json
train.sh

# Or inline
ENV=my_config train.sh
```

#### v2.2 Workflow

**Option 1: Environment-based Config (Backward Compatible)**

```bash
# Using environment variable (same as v2.1)
ENV=my_config train.sh
# Or with new CLI
simpletuner train env=my_config
```

**Option 2: Mixed Approach**

```bash
# Load base config and override specific parameters
simpletuner train env=my_config learning_rate=5e-5 num_train_epochs=50
```

## Configuration Management

### Directory Structure

#### v2.1 Git Repo Structure

```
SimpleTuner/
├── config/
│   ├── config.json          # Default config
│   ├── my_config/
│   │   ├── config.json      # Custom config
│   │   └── config.env
│   └── another_config/
│       └── config.toml
├── train.sh
└── train.py
```

#### v2.2 Workspace Structure (Pip Install)

```
my_training_project/         # आपका workspace (git repo नहीं, लेकिन चाहें तो version control में commit कर सकते हैं)
├── config/
│   ├── config.json          # Default config
│   ├── config.env           # Fallback when no env specified
│   ├── my_config/
│   │   └── config.json      # Custom config
│   └── another_config/
│       └── config.toml
├── cache/                   # VAE/text encoder caches
├── output/                  # Training outputs
└── datasets/               # आपका training डेटा
```

### Config Loading Priority

#### v2.1

1. `ENV` environment variable चेक करें
2. `config/${ENV}/config.{json,toml,env}` लोड करें
3. `config/config.{json,toml,env}` पर fallback करें

#### v2.2

1. Command-line arguments (सबसे उच्च प्राथमिकता)
2. `SIMPLETUNER_ENV` या `ENV` variable चेक करें
3. current directory या config subdirectory से config लोड करें
4. यदि env निर्दिष्ट नहीं है तो `config.env` उपयोग करें
5. CLI argument overrides लागू करें

### Environment Variables

v2.2 संगतता के लिए कई environment variable नाम सपोर्ट करता है:

```bash
# ये सभी v2.2 में काम करते हैं:
SIMPLETUNER_ENV=my_config bash train.sh
SIMPLETUNER_ENVIRONMENT=my_config bash train.sh
ENV=my_config bash train.sh  # v2.1 compatible

# Config backend selection
SIMPLETUNER_CONFIG_BACKEND=json  # या toml, env
CONFIG_BACKEND=json               # v2.1 compatible
CONFIG_TYPE=json                  # legacy support
```

### Git से Workspace में माइग्रेशन

मौजूदा v2.1 git रिपॉज़िटरी config setup को v2.2 pip-based workspace में माइग्रेट करने के लिए:

```bash
# 1. आपकी मौजूदा SimpleTuner clone
cd /path/to/SimpleTuner

# 2. नया workspace बनाएं
mkdir ~/training_workspace

# 3. Configurations कॉपी करें - मान लें आपके पास subfolder आधारित config envs हैं।
cp -r config/* ~/training_workspace/config/

# 4. Dataloader config cache locations के paths अपडेट करें

# 5. Datasets के paths relocate, link, या update करें

# 6. Workspace में python environment सेट करें
cd ~/training_workspace
python3.13 -m venv .venv # यदि चाहें तो इस workspace के लिए नया venv बनाएं
pip install simpletuner  # नया v2.2 पैकेज इंस्टॉल करें

# 7. यदि चाहें तो पुराना SimpleTuner इंस्टॉलेशन हटाएँ
# rm -rf /path/to/SimpleTuner

# 8. Workspace से training चलाएँ
simpletuner train env=my_config learning_rate=5e-5
```

### Multi-GPU Training

v2.1 में multi-gpu training कॉन्फ़िगर करने के वही तरीके v2.2 में भी लागू हैं:

```bash
# Accelerate config (recommended)
accelerate config  # एक बार run करें और interactive menu फॉलो करें

# config.env में सेट करें जिसे simpletuner CLI पढ़ेगा
echo "export TRAINING_NUM_PROCESSES=4" >> ~/my_workspace/config/config.env
```

### Quick experiments चलाना

**v2.1:** हर experiment के लिए नया config डायरेक्टरी बनानी पड़ती थी और paths/values अलग-अलग अपडेट करने पड़ते थे

**v2.2:** अलग पैरामीटर्स के साथ तुरंत experiments चलाएँ:

```bash
simpletuner train learning_rate=1e-4 batch_size=1 tracker_run_name="training experiment 1"
simpletuner train learning_rate=5e-5 batch_size=2 tracker_run_name="training experiment 2"
simpletuner train learning_rate=1e-5 batch_size=4 tracker_run_name="training experiment 3"
```

## सामान्य समस्याएँ और समाधान

### समस्या 1: Config नहीं मिला

**समस्या:** `simpletuner env=my_config` कॉन्फ़िगरेशन नहीं ढूँढ पा रहा
**समाधान:** सुनिश्चित करें कि config वर्तमान डायरेक्टरी में `config/my_config/config.json` पर मौजूद है

### समस्या 2: Path Resolution

**समस्या:** माइग्रेशन के बाद config फाइलों के absolute paths टूट रहे हैं
**समाधान:** workspace root से relative paths पर अपडेट करें

### समस्या 3: Environment Variables

**समस्या:** पुराना ENV variable काम नहीं कर रहा
**समाधान:** सुनिश्चित करें कि paths सही हैं और फाइलें मिल रही हैं

### समस्या 4: Missing CLI Command

**समस्या:** `simpletuner` कमांड नहीं मिल रही
**समाधान:** virtualenv सक्षम करें और पुनः प्रयास करें, या pip के जरिए SimpleTuner फिर से इंस्टॉल करें
