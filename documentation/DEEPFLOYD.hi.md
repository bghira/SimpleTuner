# DeepFloyd IF

> ü§∑üèΩ‚Äç‚ôÇÔ∏è DeepFloyd ‡§ü‡•ç‡§∞‡•á‡§® ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è LoRA ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡§Æ ‡§∏‡•á ‡§ï‡§Æ 24G VRAM ‡§ö‡§æ‡§π‡§ø‡§è‡•§ ‡§Ø‡§π ‡§ó‡§æ‡§á‡§° 400M ‡§™‡•à‡§∞‡§æ‡§Æ‡•Ä‡§ü‡§∞ ‡§µ‡§æ‡§≤‡•á ‡§¨‡•á‡§∏ ‡§Æ‡•â‡§°‡§≤ ‡§™‡§∞ ‡§ï‡•á‡§Ç‡§¶‡•ç‡§∞‡§ø‡§§ ‡§π‡•à, ‡§π‡§æ‡§≤‡§æ‡§Ç‡§ï‡§ø 4.3B XL ‡§µ‡•á‡§∞‡§ø‡§è‡§Ç‡§ü ‡§ï‡•ã ‡§≠‡•Ä ‡§á‡§®‡•ç‡§π‡•Ä‡§Ç ‡§¶‡§ø‡§∂‡§æ‡§®‡§ø‡§∞‡•ç‡§¶‡•á‡§∂‡•ã‡§Ç ‡§∏‡•á ‡§ü‡•ç‡§∞‡•á‡§® ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ ‡§∏‡§ï‡§§‡§æ ‡§π‡•à‡•§

## ‡§™‡•É‡§∑‡•ç‡§†‡§≠‡•Ç‡§Æ‡§ø

2023 ‡§ï‡•Ä ‡§µ‡§∏‡§Ç‡§§ ‡§Æ‡•á‡§Ç, StabilityAI ‡§®‡•á DeepFloyd ‡§®‡§æ‡§Æ ‡§ï‡§æ cascaded pixel diffusion ‡§Æ‡•â‡§°‡§≤ ‡§∞‡§ø‡§≤‡•Ä‡§ú‡§º ‡§ï‡§ø‡§Ø‡§æ‡•§
![](https://tripleback.net/public/deepfloyd.png)

Stable Diffusion XL ‡§∏‡•á ‡§∏‡§Ç‡§ï‡•ç‡§∑‡§ø‡§™‡•ç‡§§ ‡§§‡•Å‡§≤‡§®‡§æ:
- ‡§ü‡•á‡§ï‡•ç‡§∏‡•ç‡§ü ‡§è‡§®‡•ç‡§ï‡•ã‡§°‡§∞
  - SDXL ‡§¶‡•ã CLIP ‡§è‡§®‡•ç‡§ï‡•ã‡§°‡§∞‡•ç‡§∏ ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§§‡§æ ‡§π‡•à: "OpenCLIP G/14" ‡§î‡§∞ "OpenAI CLIP-L/14"
  - DeepFloyd ‡§è‡§ï single self‚Äësupervised transformer ‡§Æ‡•â‡§°‡§≤, Google ‡§ï‡§æ T5 XXL ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§§‡§æ ‡§π‡•à
- ‡§™‡•à‡§∞‡§æ‡§Æ‡•Ä‡§ü‡§∞ count
  - DeepFloyd ‡§ï‡§à ‡§Ü‡§ï‡§æ‡§∞‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§Ü‡§§‡§æ ‡§π‡•à: 400M, 900M, ‡§î‡§∞ 4.3B ‡§™‡•à‡§∞‡§æ‡§Æ‡•Ä‡§ü‡§∞‡•ç‡§∏‡•§ ‡§π‡§∞ ‡§¨‡§°‡§º‡§æ ‡§Æ‡•â‡§°‡§≤ ‡§ï‡•ç‡§∞‡§Æ‡§∂‡§É ‡§Æ‡§π‡§Ç‡§ó‡§æ ‡§ü‡•ç‡§∞‡•á‡§® ‡§π‡•ã‡§§‡§æ ‡§π‡•à‡•§
  - SDXL ‡§Æ‡•á‡§Ç ‡§∏‡§ø‡§∞‡•ç‡§´‡§º ‡§è‡§ï ‡§π‡•à, ~3B ‡§™‡•à‡§∞‡§æ‡§Æ‡•Ä‡§ü‡§∞‡•ç‡§∏‡•§
  - DeepFloyd ‡§ï‡§æ ‡§ü‡•á‡§ï‡•ç‡§∏‡•ç‡§ü ‡§è‡§®‡•ç‡§ï‡•ã‡§°‡§∞ ‡§Ö‡§ï‡•á‡§≤‡•á 11B ‡§™‡•à‡§∞‡§æ‡§Æ‡•Ä‡§ü‡§∞‡•ç‡§∏ ‡§ï‡§æ ‡§π‡•à, ‡§ú‡§ø‡§∏‡§∏‡•á ‡§∏‡§¨‡§∏‡•á ‡§¨‡§°‡§º‡§æ ‡§ï‡•â‡§®‡•ç‡§´‡§º‡§ø‡§ó ‡§≤‡§ó‡§≠‡§ó 15.3B ‡§™‡•à‡§∞‡§æ‡§Æ‡•Ä‡§ü‡§∞‡•ç‡§∏ ‡§π‡•ã ‡§ú‡§æ‡§§‡§æ ‡§π‡•à‡•§
- ‡§Æ‡•â‡§°‡§≤ count
  - DeepFloyd **‡§§‡•Ä‡§®** ‡§∏‡•ç‡§ü‡•á‡§ú ‡§Æ‡•á‡§Ç ‡§ö‡§≤‡§§‡§æ ‡§π‡•à: 64px -> 256px -> 1024px
    - ‡§π‡§∞ ‡§∏‡•ç‡§ü‡•á‡§ú ‡§Ö‡§™‡§®‡§æ denoising ‡§â‡§¶‡•ç‡§¶‡•á‡§∂‡•ç‡§Ø ‡§™‡•Ç‡§∞‡•Ä ‡§§‡§∞‡§π ‡§™‡•Ç‡§∞‡§æ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à
  - SDXL **‡§¶‡•ã** ‡§∏‡•ç‡§ü‡•á‡§ú ‡§Æ‡•á‡§Ç ‡§ö‡§≤‡§§‡§æ ‡§π‡•à, ‡§∞‡§ø‡§´‡§º‡§æ‡§á‡§®‡§∞ ‡§∏‡§π‡§ø‡§§, 1024px -> 1024px
    - ‡§π‡§∞ ‡§∏‡•ç‡§ü‡•á‡§ú ‡§ï‡•á‡§µ‡§≤ ‡§Ü‡§Ç‡§∂‡§ø‡§ï ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§Ö‡§™‡§®‡§æ denoising ‡§â‡§¶‡•ç‡§¶‡•á‡§∂‡•ç‡§Ø ‡§™‡•Ç‡§∞‡§æ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à
- ‡§°‡§ø‡§ú‡§º‡§æ‡§á‡§®
  - DeepFloyd ‡§ï‡•á ‡§§‡•Ä‡§® ‡§Æ‡•â‡§°‡§≤ resolution ‡§î‡§∞ fine details ‡§¨‡§¢‡§º‡§æ‡§§‡•á ‡§π‡•à‡§Ç
  - SDXL ‡§ï‡•á ‡§¶‡•ã ‡§Æ‡•â‡§°‡§≤ fine details ‡§î‡§∞ composition ‡§∏‡§Ç‡§≠‡§æ‡§≤‡§§‡•á ‡§π‡•à‡§Ç

‡§¶‡•ã‡§®‡•ã‡§Ç ‡§Æ‡•â‡§°‡§≤‡•ã‡§Ç ‡§Æ‡•á‡§Ç, ‡§™‡§π‡§≤‡§æ ‡§∏‡•ç‡§ü‡•á‡§ú ‡§á‡§Æ‡•á‡§ú ‡§ï‡•Ä ‡§Ö‡§ß‡§ø‡§ï‡§§‡§∞ composition ‡§§‡§Ø ‡§ï‡§∞‡§§‡§æ ‡§π‡•à (‡§ú‡§π‡§æ‡§Å ‡§¨‡§°‡§º‡•á ‡§Ü‡§á‡§ü‡§Æ/‡§∂‡•à‡§°‡•ã‡§ú‡§º ‡§¶‡§ø‡§ñ‡§æ‡§à ‡§¶‡•á‡§§‡•á ‡§π‡•à‡§Ç)‡•§

## ‡§Æ‡•â‡§°‡§≤ ‡§Æ‡•Ç‡§≤‡•ç‡§Ø‡§æ‡§Ç‡§ï‡§®

DeepFloyd ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§§‡•á ‡§∏‡§Æ‡§Ø ‡§Ü‡§™ ‡§Ø‡§π ‡§Ö‡§™‡•á‡§ï‡•ç‡§∑‡§æ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§

### ‡§∏‡•å‡§Ç‡§¶‡§∞‡•ç‡§Ø (Aesthetics)

SDXL ‡§Ø‡§æ Stable Diffusion 1.x/2.x ‡§ï‡•Ä ‡§§‡•Å‡§≤‡§®‡§æ ‡§Æ‡•á‡§Ç, DeepFloyd ‡§ï‡•Ä aesthetics Stable Diffusion 2.x ‡§î‡§∞ SDXL ‡§ï‡•á ‡§¨‡•Ä‡§ö ‡§ï‡§π‡•Ä‡§Ç ‡§Ü‡§§‡•Ä ‡§π‡•à‡§Ç‡•§


### ‡§®‡•Å‡§ï‡§∏‡§æ‡§®

‡§Ø‡§π ‡§Æ‡•â‡§°‡§≤ ‡§ï‡§à ‡§ï‡§æ‡§∞‡§£‡•ã‡§Ç ‡§∏‡•á ‡§≤‡•ã‡§ï‡§™‡•ç‡§∞‡§ø‡§Ø ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à:

- inference‚Äëtime compute VRAM ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï‡§§‡§æ ‡§Ö‡§®‡•ç‡§Ø ‡§Æ‡•â‡§°‡§≤‡•ã‡§Ç ‡§∏‡•á ‡§Ö‡§ß‡§ø‡§ï ‡§π‡•à
- training‚Äëtime compute VRAM ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï‡§§‡§æ‡§è‡§Å ‡§Ö‡§®‡•ç‡§Ø ‡§Æ‡•â‡§°‡§≤‡•ã‡§Ç ‡§∏‡•á ‡§ï‡§æ‡§´‡§º‡•Ä ‡§Ö‡§ß‡§ø‡§ï ‡§π‡•à‡§Ç
  - full u‚Äënet tune ‡§ï‡•á ‡§≤‡§ø‡§è 48G VRAM ‡§∏‡•á ‡§Ö‡§ß‡§ø‡§ï ‡§ö‡§æ‡§π‡§ø‡§è
  - rank‚Äë32, batch‚Äë4 LoRA ‡§ï‡•ã ~24G VRAM ‡§ö‡§æ‡§π‡§ø‡§è
  - ‡§ü‡•á‡§ï‡•ç‡§∏‡•ç‡§ü embed cache ‡§ë‡§¨‡•ç‡§ú‡•á‡§ï‡•ç‡§ü‡•ç‡§∏ ‡§¨‡§π‡•Å‡§§ ‡§¨‡§°‡§º‡•á ‡§π‡•à‡§Ç (‡§™‡•ç‡§∞‡§§‡•ç‡§Ø‡•á‡§ï ‡§ï‡§à ‡§Æ‡•á‡§ó‡§æ‡§¨‡§æ‡§á‡§ü, ‡§ú‡§¨‡§ï‡§ø SDXL ‡§ï‡•á dual CLIP embeds ‡§ï‡•á‡§µ‡§≤ ‡§∏‡•à‡§ï‡§°‡§º‡•ã‡§Ç ‡§ï‡§ø‡§≤‡§æ‡§¨‡§æ‡§á‡§ü)
  - ‡§ü‡•á‡§ï‡•ç‡§∏‡•ç‡§ü embed cache ‡§¨‡§π‡•Å‡§§ ‡§ß‡•Ä‡§Æ‡•á ‡§¨‡§®‡§§‡•á ‡§π‡•à‡§Ç ‚Äî ‡§Ö‡§≠‡•Ä A6000 non‚ÄëAda ‡§™‡§∞ ‡§≤‡§ó‡§≠‡§ó 9‚Äë10 ‡§™‡•ç‡§∞‡§§‡§ø ‡§∏‡•á‡§ï‡§Ç‡§°
- ‡§°‡§ø‡§´‡§º‡•â‡§≤‡•ç‡§ü aesthetic ‡§Ö‡§®‡•ç‡§Ø ‡§Æ‡•â‡§°‡§≤‡•ã‡§Ç ‡§∏‡•á ‡§ñ‡§∞‡§æ‡§¨ ‡§π‡•à (‡§ú‡•à‡§∏‡•á vanilla SD 1.5 ‡§ü‡•ç‡§∞‡•á‡§® ‡§ï‡§∞‡§®‡§æ)
- inference ‡§ï‡•á ‡§¶‡•å‡§∞‡§æ‡§® **‡§§‡•Ä‡§®** ‡§Æ‡•â‡§°‡§≤ ‡§´‡§æ‡§á‡§®‡§ü‡•ç‡§Ø‡•Ç‡§®/‡§≤‡•ã‡§° ‡§ï‡§∞‡§®‡•á ‡§™‡§°‡§º‡§§‡•á ‡§π‡•à‡§Ç (‡§ü‡•á‡§ï‡•ç‡§∏‡•ç‡§ü ‡§è‡§®‡•ç‡§ï‡•ã‡§°‡§∞ ‡§ú‡•ã‡§°‡§º‡•á‡§Ç ‡§§‡•ã ‡§ö‡§æ‡§∞)
- StabilityAI ‡§ï‡•á ‡§µ‡§æ‡§¶‡•á ‡§µ‡§æ‡§∏‡•ç‡§§‡§µ‡§ø‡§ï ‡§â‡§™‡§Ø‡•ã‡§ó ‡§Ö‡§®‡•Å‡§≠‡§µ ‡§∏‡•á ‡§Æ‡•á‡§≤ ‡§®‡§π‡•Ä‡§Ç ‡§ñ‡§æ‡§è (over‚Äëhyped)
- DeepFloyd‚ÄëIF ‡§≤‡§æ‡§á‡§∏‡•á‡§Ç‡§∏ commercial ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡•á ‡§ñ‡§ø‡§≤‡§æ‡§´ ‡§™‡•ç‡§∞‡§§‡§ø‡§¨‡§Ç‡§ß‡§æ‡§§‡•ç‡§Æ‡§ï ‡§π‡•à
  - ‡§á‡§∏‡§∏‡•á NovelAI ‡§µ‡•á‡§ü‡•ç‡§∏ ‡§™‡§∞ ‡§Ö‡§∏‡§∞ ‡§®‡§π‡•Ä‡§Ç ‡§™‡§°‡§º‡§æ, ‡§ú‡•ã ‡§Ö‡§µ‡•à‡§ß ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§≤‡•Ä‡§ï ‡§π‡•Å‡§è ‡§•‡•á‡•§ ‡§µ‡§æ‡§£‡§ø‡§ú‡•ç‡§Ø‡§ø‡§ï ‡§≤‡§æ‡§á‡§∏‡•á‡§Ç‡§∏ ‡§ï‡§æ ‡§π‡§µ‡§æ‡§≤‡§æ ‡§Ö‡§®‡•ç‡§Ø ‡§¨‡§°‡§º‡•á ‡§Æ‡•Å‡§¶‡•ç‡§¶‡•ã‡§Ç ‡§ï‡•Ä ‡§§‡•Å‡§≤‡§®‡§æ ‡§Æ‡•á‡§Ç ‡§è‡§ï ‡§∏‡•Å‡§µ‡§ø‡§ß‡§æ‡§ú‡§®‡§ï ‡§¨‡§π‡§æ‡§®‡§æ ‡§≤‡§ó‡§§‡§æ ‡§π‡•à‡•§

### ‡§´‡§æ‡§Ø‡§¶‡•á

‡§π‡§æ‡§≤‡§æ‡§Å‡§ï‡§ø, DeepFloyd ‡§ï‡•á ‡§ï‡•Å‡§õ ‡§´‡§æ‡§Ø‡§¶‡•á ‡§π‡•à‡§Ç ‡§ú‡•ã ‡§Ö‡§ï‡•ç‡§∏‡§∞ ‡§®‡§ú‡§º‡§∞‡§Ö‡§Ç‡§¶‡§æ‡§ú‡§º ‡§π‡•ã‡§§‡•á ‡§π‡•à‡§Ç:

- inference ‡§∏‡§Æ‡§Ø ‡§™‡§∞, T5 ‡§ü‡•á‡§ï‡•ç‡§∏‡•ç‡§ü ‡§è‡§®‡•ç‡§ï‡•ã‡§°‡§∞ ‡§¶‡•Å‡§®‡§ø‡§Ø‡§æ ‡§ï‡•Ä ‡§Ö‡§ö‡•ç‡§õ‡•Ä ‡§∏‡§Æ‡§ù ‡§¶‡§ø‡§ñ‡§æ‡§§‡§æ ‡§π‡•à
- ‡§¨‡§π‡•Å‡§§‚Äë‡§≤‡§Ç‡§¨‡•á captions ‡§™‡§∞ native training ‡§∏‡§Ç‡§≠‡§µ ‡§π‡•à
- ‡§™‡§π‡§≤‡§æ ‡§∏‡•ç‡§ü‡•á‡§ú ~64x64 pixel area ‡§π‡•à, ‡§î‡§∞ multi‚Äëaspect resolutions ‡§™‡§∞ ‡§ü‡•ç‡§∞‡•á‡§® ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ ‡§∏‡§ï‡§§‡§æ ‡§π‡•à
  - ‡§ü‡•ç‡§∞‡•á‡§®‡§ø‡§Ç‡§ó ‡§°‡•á‡§ü‡§æ ‡§ï‡•á low‚Äëresolution ‡§π‡•ã‡§®‡•á ‡§ï‡§æ ‡§Æ‡§§‡§≤‡§¨ ‡§π‡•à ‡§ï‡§ø DeepFloyd _‡§è‡§ï‡§Æ‡§æ‡§§‡•ç‡§∞ ‡§Æ‡•â‡§°‡§≤_ ‡§•‡§æ ‡§ú‡•ã LAION‚ÄëA ‡§ï‡•á _‡§∏‡§≠‡•Ä_ ‡§°‡•á‡§ü‡§æ ‡§™‡§∞ ‡§ü‡•ç‡§∞‡•á‡§® ‡§π‡•ã ‡§∏‡§ï‡§§‡§æ ‡§•‡§æ (LAION ‡§Æ‡•á‡§Ç ‡§¨‡§π‡•Å‡§§ ‡§ï‡§Æ ‡§á‡§Æ‡•á‡§ú 64x64 ‡§∏‡•á ‡§õ‡•ã‡§ü‡•Ä ‡§π‡•à‡§Ç)
- ‡§π‡§∞ ‡§∏‡•ç‡§ü‡•á‡§ú ‡§ï‡•ã ‡§Ö‡§≤‡§ó‚Äë‡§Ö‡§≤‡§ó ‡§â‡§¶‡•ç‡§¶‡•á‡§∂‡•ç‡§Ø ‡§ï‡•á ‡§≤‡§ø‡§è independently ‡§ü‡•ç‡§Ø‡•Ç‡§® ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ ‡§∏‡§ï‡§§‡§æ ‡§π‡•à
  - ‡§™‡§π‡§≤‡§æ ‡§∏‡•ç‡§ü‡•á‡§ú composition ‡§ó‡•Å‡§£‡•ã‡§Ç ‡§™‡§∞ ‡§´‡•ã‡§ï‡§∏ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à, ‡§î‡§∞ ‡§¨‡§æ‡§¶ ‡§ï‡•á ‡§∏‡•ç‡§ü‡•á‡§ú upscaled details ‡§¨‡•á‡§π‡§§‡§∞ ‡§ï‡§∞‡§®‡•á ‡§™‡§∞
- ‡§¨‡§°‡§º‡•á ‡§Æ‡•á‡§Æ‡•ã‡§∞‡•Ä footprint ‡§ï‡•á ‡§¨‡§æ‡§µ‡§ú‡•Ç‡§¶ ‡§Ø‡§π ‡§§‡•á‡§ú‡§º ‡§ü‡•ç‡§∞‡•á‡§® ‡§π‡•ã‡§§‡§æ ‡§π‡•à
  - throughput ‡§ï‡•á ‡§≤‡§ø‡§π‡§æ‡§ú‡§º ‡§∏‡•á ‡§§‡•á‡§ú‡§º ‚Äî stage 1 tuning ‡§Æ‡•á‡§Ç ‡§â‡§ö‡•ç‡§ö samples‚Äëper‚Äëhour ‡§¶‡§ø‡§ñ‡§§‡•á ‡§π‡•à‡§Ç
  - CLIP‚Äë‡§∏‡§Æ‡§ï‡§ï‡•ç‡§∑ ‡§Æ‡•â‡§°‡§≤‡•ç‡§∏ ‡§ï‡•Ä ‡§§‡•Å‡§≤‡§®‡§æ ‡§Æ‡•á‡§Ç ‡§§‡•á‡§ú‡§º ‡§∏‡•Ä‡§ñ‡§§‡§æ ‡§π‡•à, ‡§ú‡•ã ‡§â‡§® ‡§≤‡•ã‡§ó‡•ã‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ö‡•Å‡§®‡•å‡§§‡•Ä ‡§π‡•ã ‡§∏‡§ï‡§§‡§æ ‡§π‡•à ‡§ú‡•ã CLIP ‡§Æ‡•â‡§°‡§≤ ‡§ü‡•ç‡§∞‡•á‡§® ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§Ü‡§¶‡•Ä ‡§π‡•à‡§Ç
    - ‡§Æ‡§§‡§≤‡§¨ ‡§Ü‡§™‡§ï‡•ã learning rates ‡§î‡§∞ training schedules ‡§ï‡•ã ‡§≤‡•á‡§ï‡§∞ ‡§Ö‡§™‡•á‡§ï‡•ç‡§∑‡§æ‡§è‡§Å ‡§∏‡§Æ‡§æ‡§Ø‡•ã‡§ú‡§ø‡§§ ‡§ï‡§∞‡§®‡•Ä ‡§π‡•ã‡§Ç‡§ó‡•Ä
- ‡§á‡§∏‡§Æ‡•á‡§Ç VAE ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à; training samples ‡§∏‡•Ä‡§ß‡•á target size ‡§Æ‡•á‡§Ç downscale ‡§π‡•ã‡§§‡•á ‡§π‡•à‡§Ç ‡§î‡§∞ pixels ‡§∏‡•Ä‡§ß‡•á U‚Äënet ‡§ï‡•ã ‡§¶‡§ø‡§è ‡§ú‡§æ‡§§‡•á ‡§π‡•à‡§Ç
- ‡§Ø‡§π ControlNet LoRAs ‡§î‡§∞ ‡§Ö‡§®‡•ç‡§Ø ‡§ï‡§à ‡§ü‡•ç‡§∞‡§ø‡§ï‡•ç‡§∏ ‡§ï‡•ã ‡§∏‡§™‡•ã‡§∞‡•ç‡§ü ‡§ï‡§∞‡§§‡§æ ‡§π‡•à ‡§ú‡•ã ‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø linear CLIP u‚Äënets ‡§™‡§∞ ‡§ï‡§æ‡§Æ ‡§ï‡§∞‡§§‡•á ‡§π‡•à‡§Ç

## LoRA ‡§ï‡•ã ‡§´‡§æ‡§á‡§®‚Äë‡§ü‡•ç‡§Ø‡•Ç‡§® ‡§ï‡§∞‡§®‡§æ

> ‚ö†Ô∏è DeepFloyd ‡§ï‡•á ‡§∏‡§¨‡§∏‡•á ‡§õ‡•ã‡§ü‡•á 400M ‡§Æ‡•â‡§°‡§≤ ‡§Æ‡•á‡§Ç ‡§≠‡•Ä full u‚Äënet backpropagation ‡§ï‡•Ä compute ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï‡§§‡§æ‡§è‡§Å ‡§¨‡§π‡•Å‡§§ ‡§Ö‡§ß‡§ø‡§ï ‡§π‡•à‡§Ç, ‡§á‡§∏‡§≤‡§ø‡§è ‡§á‡§∏‡•á ‡§ü‡•á‡§∏‡•ç‡§ü ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à‡•§ ‡§á‡§∏ ‡§¶‡§∏‡•ç‡§§‡§æ‡§µ‡•á‡§ú‡§º ‡§Æ‡•á‡§Ç LoRA ‡§â‡§™‡§Ø‡•ã‡§ó ‡§π‡•ã‡§ó‡§æ, ‡§π‡§æ‡§≤‡§æ‡§Ç‡§ï‡§ø full u‚Äënet tuning ‡§≠‡•Ä ‡§ï‡§æ‡§Æ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•Ä ‡§π‡•à‡•§

‡§Ø‡•á ‡§®‡§ø‡§∞‡•ç‡§¶‡•á‡§∂ SimpleTuner ‡§∏‡•á ‡§¨‡•á‡§∏‡§ø‡§ï ‡§™‡§∞‡§ø‡§ö‡§ø‡§§‡§§‡§æ ‡§Æ‡§æ‡§®‡§§‡•á ‡§π‡•à‡§Ç‡•§ ‡§®‡§è ‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ‡§ì‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è [Kwai Kolors](quickstart/KOLORS.md) ‡§ú‡•à‡§∏‡•á ‡§¨‡•á‡§π‡§§‡§∞‚Äë‡§∏‡§Æ‡§∞‡•ç‡§•‡§ø‡§§ ‡§Æ‡•â‡§°‡§≤ ‡§∏‡•á ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡§®‡§æ ‡§Ö‡§®‡•Å‡§∂‡§Ç‡§∏‡§ø‡§§ ‡§π‡•à‡•§

‡§π‡§æ‡§≤‡§æ‡§Å‡§ï‡§ø, ‡§Ø‡§¶‡§ø ‡§Ü‡§™ DeepFloyd ‡§ü‡•ç‡§∞‡•á‡§® ‡§ï‡§∞‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç, ‡§§‡•ã ‡§Ü‡§™‡§ï‡•ã `model_flavour` ‡§ï‡•â‡§®‡•ç‡§´‡§º‡§ø‡§ó‡§∞‡•á‡§∂‡§® ‡§µ‡§ø‡§ï‡§≤‡•ç‡§™ ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§ï‡•á ‡§Ø‡§π ‡§¨‡§§‡§æ‡§®‡§æ ‡§π‡•ã‡§ó‡§æ ‡§ï‡§ø ‡§Ü‡§™ ‡§ï‡•å‡§® ‡§∏‡§æ ‡§Æ‡•â‡§°‡§≤ ‡§ü‡•ç‡§∞‡•á‡§® ‡§ï‡§∞ ‡§∞‡§π‡•á ‡§π‡•à‡§Ç‡•§

### config.json

```bash
"model_family": "deepfloyd",

# Possible values:
# - i-medium-400m
# - i-large-900m
# - i-xlarge-4.3b
# - ii-medium-450m
# - ii-large-1.2b
"model_flavour": "i-medium-400m",

# DoRA isn't tested a whole lot yet. It's still new and experimental.
"use_dora": false,
# Bitfit hasn't been tested for efficacy on DeepFloyd.
# It will probably work, but no idea what the outcome is.
"use_bitfit": false,

# Highest learning rate to use.
"learning_rate": 4e-5,
# For schedules that decay or oscillate, this will be the end LR or the bottom of the valley.
"lr_end": 4e-6,
```

- `model_family` ‡§ï‡§æ ‡§Æ‡§æ‡§® deepfloyd ‡§π‡•à
- `model_flavour` Stage I ‡§Ø‡§æ II ‡§ï‡•Ä ‡§ì‡§∞ ‡§á‡§Ç‡§ó‡§ø‡§§ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à
- `resolution` ‡§Ö‡§¨ `64` ‡§π‡•à ‡§î‡§∞ `resolution_type` `pixel` ‡§π‡•à
- `attention_mechanism` ‡§ï‡•ã `xformers` ‡§∏‡•á‡§ü ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ ‡§∏‡§ï‡§§‡§æ ‡§π‡•à, ‡§≤‡•á‡§ï‡§ø‡§® AMD ‡§î‡§∞ Apple ‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ ‡§á‡§∏‡•á ‡§∏‡•á‡§ü ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§∞ ‡§™‡§æ‡§è‡§Å‡§ó‡•á, ‡§ú‡§ø‡§∏‡§∏‡•á ‡§Ö‡§ß‡§ø‡§ï VRAM ‡§ï‡•Ä ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï‡§§‡§æ ‡§π‡•ã‡§ó‡•Ä
  - **Note** ~~Apple MPS ‡§Æ‡•á‡§Ç ‡§´‡§ø‡§≤‡§π‡§æ‡§≤ ‡§è‡§ï ‡§¨‡§ó ‡§π‡•à ‡§ú‡•ã DeepFloyd tuning ‡§ï‡•ã ‡§ï‡§æ‡§Æ ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§∞‡§®‡•á ‡§¶‡•á‡§§‡§æ ‡§•‡§æ‡•§~~ PyTorch 2.6 ‡§Ø‡§æ ‡§â‡§∏‡§∏‡•á ‡§™‡§π‡§≤‡•á ‡§ï‡•á ‡§∏‡§Ç‡§∏‡•ç‡§ï‡§∞‡§£‡•ã‡§Ç ‡§∏‡•á, stage I ‡§î‡§∞ II ‡§¶‡•ã‡§®‡•ã‡§Ç Apple MPS ‡§™‡§∞ ‡§ü‡•ç‡§∞‡•á‡§® ‡§π‡•ã‡§§‡•á ‡§π‡•à‡§Ç‡•§

‡§Ö‡§ß‡§ø‡§ï thorough validation ‡§ï‡•á ‡§≤‡§ø‡§è, `validation_resolution` ‡§ï‡§æ ‡§Æ‡§æ‡§® ‡§á‡§∏ ‡§§‡§∞‡§π ‡§∏‡•á‡§ü ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ ‡§∏‡§ï‡§§‡§æ ‡§π‡•à:

- `validation_resolution=64` 64x64 square image ‡§¶‡•á‡§ó‡§æ‡•§
- `validation_resolution=96x64` 3:2 widescreen image ‡§¶‡•á‡§ó‡§æ‡•§
- `validation_resolution=64,96,64x96,96x64` ‡§™‡•ç‡§∞‡§§‡•ç‡§Ø‡•á‡§ï validation ‡§™‡§∞ ‡§ö‡§æ‡§∞ ‡§á‡§Æ‡•á‡§ú ‡§¨‡§®‡§æ‡§è‡§ó‡§æ:
  - 64x64
  - 96x96
  - 64x96
  - 96x64

### multidatabackend_deepfloyd.json

‡§Ö‡§¨ DeepFloyd ‡§™‡•ç‡§∞‡§∂‡§ø‡§ï‡•ç‡§∑‡§£ ‡§ï‡•á ‡§≤‡§ø‡§è dataloader ‡§ï‡•â‡§®‡•ç‡§´‡§º‡§ø‡§ó‡§∞‡•á‡§∂‡§® ‡§™‡§∞ ‡§ö‡§≤‡§§‡•á ‡§π‡•à‡§Ç‡•§ ‡§Ø‡§π SDXL ‡§Ø‡§æ legacy ‡§Æ‡•â‡§°‡§≤ datasets ‡§ï‡•Ä ‡§ï‡•â‡§®‡•ç‡§´‡§º‡§ø‡§ó‡§∞‡•á‡§∂‡§® ‡§ú‡•à‡§∏‡§æ ‡§π‡•Ä ‡§π‡•ã‡§ó‡§æ, ‡§´‡§º‡•ã‡§ï‡§∏ resolution ‡§™‡•à‡§∞‡§æ‡§Æ‡•Ä‡§ü‡§∞‡•ç‡§∏ ‡§™‡§∞ ‡§∞‡§π‡•á‡§ó‡§æ‡•§

```json
[
    {
        "id": "primary-dataset",
        "type": "local",
        "instance_data_dir": "/training/data/primary-dataset",
        "crop": true,
        "crop_aspect": "square",
        "crop_style": "random",
        "resolution": 64,
        "resolution_type": "pixel",
        "minimum_image_size": 64,
        "maximum_image_size": 256,
        "target_downsample_size": 128,
        "prepend_instance_prompt": false,
        "instance_prompt": "Your Subject Trigger Phrase or Word",
        "caption_strategy": "instanceprompt",
        "repeats": 1
    },
    {
        "id": "an example backend for text embeds.",
        "dataset_type": "text_embeds",
        "default": true,
        "disable": false,
        "type": "local",
        "cache_dir": "/training/cache/deepfloyd/text/dreambooth"
    }
]
```

‡§ä‡§™‡§∞ DeepFloyd ‡§ï‡•á ‡§≤‡§ø‡§è ‡§è‡§ï ‡§¨‡•á‡§∏‡§ø‡§ï Dreambooth ‡§ï‡•â‡§®‡•ç‡§´‡§º‡§ø‡§ó‡§∞‡•á‡§∂‡§® ‡§¶‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à:

- `resolution` ‡§î‡§∞ `resolution_type` ‡§ï‡•á ‡§Æ‡§æ‡§® ‡§ï‡•ç‡§∞‡§Æ‡§∂‡§É `64` ‡§î‡§∞ `pixel` ‡§π‡•à‡§Ç
- `minimum_image_size` ‡§ï‡•ã 64 pixels ‡§§‡§ï ‡§ò‡§ü‡§æ‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à ‡§§‡§æ‡§ï‡§ø ‡§π‡§Æ ‡§õ‡•ã‡§ü‡•á images ‡§ï‡•ã ‡§ó‡§≤‡§§‡•Ä ‡§∏‡•á upsample ‡§® ‡§ï‡§∞‡•á‡§Ç
- `maximum_image_size` ‡§ï‡•ã 256 pixels ‡§∞‡§ñ‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à ‡§§‡§æ‡§ï‡§ø ‡§¨‡§°‡§º‡•á images ‡§ï‡§æ crop ratio 4:1 ‡§∏‡•á ‡§Ö‡§ß‡§ø‡§ï ‡§® ‡§π‡•ã, ‡§ú‡•ã scene context loss ‡§ï‡§æ ‡§ï‡§æ‡§∞‡§£ ‡§¨‡§® ‡§∏‡§ï‡§§‡§æ ‡§π‡•à
- `target_downsample_size` ‡§ï‡•ã 128 pixels ‡§∏‡•á‡§ü ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à ‡§§‡§æ‡§ï‡§ø 256 pixels ‡§∏‡•á ‡§¨‡§°‡§º‡•á images ‡§™‡§π‡§≤‡•á 128 pixels ‡§§‡§ï resize ‡§π‡•ã‡§Ç ‡§î‡§∞ ‡§´‡§ø‡§∞ crop ‡§π‡•ã‡§Ç

Note: images ‡§ï‡•ã 25% ‡§ï‡•á ‡§ö‡§∞‡§£‡•ã‡§Ç ‡§Æ‡•á‡§Ç downsample ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à ‡§§‡§æ‡§ï‡§ø image size ‡§Æ‡•á‡§Ç ‡§¨‡§°‡§º‡•á jump ‡§∏‡•á scene details ‡§ï‡§æ ‡§ó‡§≤‡§§ averaging ‡§® ‡§π‡•ã‡•§

## ‡§á‡§®‡§´‡•á‡§∞‡•á‡§Ç‡§∏ ‡§ö‡§≤‡§æ‡§®‡§æ

‡§´‡§ø‡§≤‡§π‡§æ‡§≤, SimpleTuner toolkit ‡§Æ‡•á‡§Ç DeepFloyd ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡•ã‡§à dedicated inference scripts ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡§Ç‡•§

built‚Äëin validation ‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§ï‡•á ‡§Ö‡§≤‡§æ‡§µ‡§æ, ‡§Ü‡§™ Hugging Face ‡§ï‡•á [‡§á‡§∏ ‡§¶‡§∏‡•ç‡§§‡§æ‡§µ‡•á‡§ú‡§º](https://huggingface.co/docs/diffusers/v0.23.1/en/training/dreambooth#if) ‡§ï‡•ã ‡§¶‡•á‡§ñ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç, ‡§ú‡§ø‡§∏‡§Æ‡•á‡§Ç ‡§¨‡§æ‡§¶ ‡§Æ‡•á‡§Ç inference ‡§ö‡§≤‡§æ‡§®‡•á ‡§ï‡§æ ‡§õ‡•ã‡§ü‡§æ ‡§â‡§¶‡§æ‡§π‡§∞‡§£ ‡§π‡•à:

```py
from diffusers import DiffusionPipeline

pipe = DiffusionPipeline.from_pretrained("DeepFloyd/IF-I-M-v1.0", use_safetensors=True)
pipe.load_lora_weights("<lora weights path>")
pipe.scheduler = pipe.scheduler.__class__.from_config(pipe.scheduler.config, variance_type="fixed_small")
```

> ‚ö†Ô∏è ‡§ß‡•ç‡§Ø‡§æ‡§® ‡§¶‡•á‡§Ç ‡§ï‡§ø `DiffusionPipeline.from_pretrained(...)` ‡§ï‡§æ ‡§™‡§π‡§≤‡§æ ‡§Æ‡§æ‡§® `IF-I-M-v1.0` ‡§π‡•à, ‡§≤‡•á‡§ï‡§ø‡§® ‡§Ü‡§™‡§ï‡•ã ‡§á‡§∏‡•á ‡§â‡§∏ base model path ‡§∏‡•á ‡§¨‡§¶‡§≤‡§®‡§æ ‡§π‡•ã‡§ó‡§æ ‡§ú‡§ø‡§∏ ‡§™‡§∞ ‡§Ü‡§™‡§®‡•á ‡§Ö‡§™‡§®‡§æ LoRA ‡§ü‡•ç‡§∞‡•á‡§® ‡§ï‡§ø‡§Ø‡§æ ‡§π‡•à‡•§

> ‚ö†Ô∏è ‡§ß‡•ç‡§Ø‡§æ‡§® ‡§¶‡•á‡§Ç ‡§ï‡§ø Hugging Face ‡§ï‡•Ä ‡§∏‡§≠‡•Ä ‡§∏‡§ø‡§´‡§º‡§æ‡§∞‡§ø‡§∂‡•á‡§Ç SimpleTuner ‡§™‡§∞ ‡§≤‡§æ‡§ó‡•Ç ‡§®‡§π‡•Ä‡§Ç ‡§π‡•ã‡§§‡•Ä‡§Ç‡•§ ‡§â‡§¶‡§æ‡§π‡§∞‡§£ ‡§ï‡•á ‡§≤‡§ø‡§è, ‡§π‡§Æ DeepFloyd stage I LoRA ‡§ï‡•ã Diffusers ‡§ï‡•á ‡§â‡§¶‡§æ‡§π‡§∞‡§£ dreambooth scripts ‡§ï‡•á 28G ‡§ï‡•á ‡§¨‡§ú‡§æ‡§Ø ‡§ï‡•á‡§µ‡§≤ 22G VRAM ‡§Æ‡•á‡§Ç ‡§ü‡•ç‡§Ø‡•Ç‡§® ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç, efficient pre‚Äëcaching ‡§î‡§∞ pure‚Äëbf16 optimiser states ‡§ï‡•á ‡§ï‡§æ‡§∞‡§£‡•§

## Super‚Äëresolution stage II ‡§Æ‡•â‡§°‡§≤ ‡§ï‡•ã ‡§´‡§æ‡§á‡§®‚Äë‡§ü‡•ç‡§Ø‡•Ç‡§® ‡§ï‡§∞‡§®‡§æ

DeepFloyd ‡§ï‡§æ stage II ‡§Æ‡•â‡§°‡§≤ ‡§≤‡§ó‡§≠‡§ó 64x64 (‡§Ø‡§æ 96x64) ‡§á‡§®‡§™‡•Å‡§ü ‡§≤‡•á‡§§‡§æ ‡§π‡•à, ‡§î‡§∞ `VALIDATION_RESOLUTION` ‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó ‡§ï‡•á ‡§Ö‡§®‡•Å‡§∏‡§æ‡§∞ upscaled image ‡§≤‡•å‡§ü‡§æ‡§§‡§æ ‡§π‡•à‡•§

eval images ‡§Ü‡§™‡§ï‡•á datasets ‡§∏‡•á ‡§∏‡•ç‡§µ‡§§‡§É ‡§ö‡•Å‡§®‡•Ä ‡§ú‡§æ‡§§‡•Ä ‡§π‡•à‡§Ç, ‡§§‡§æ‡§ï‡§ø `--num_eval_images` ‡§Ø‡§π ‡§¨‡§§‡§æ‡§è ‡§ï‡§ø ‡§™‡•ç‡§∞‡§§‡•ç‡§Ø‡•á‡§ï dataset ‡§∏‡•á ‡§ï‡§ø‡§§‡§®‡•Ä upscale images ‡§ö‡•Å‡§®‡•Ä ‡§ú‡§æ‡§è‡§Å‡•§ images ‡§Ö‡§≠‡•Ä ‡§∞‡•à‡§Ç‡§°‡§Æ ‡§ö‡•Å‡§®‡§§‡•á ‡§π‡•à‡§Ç ‚Äî ‡§≤‡•á‡§ï‡§ø‡§® ‡§π‡§∞ session ‡§Æ‡•á‡§Ç ‡§µ‡§π‡•Ä ‡§¨‡§®‡•Ä ‡§∞‡§π‡§§‡•Ä ‡§π‡•à‡§Ç‡•§

‡§ï‡•Å‡§õ ‡§Ö‡§§‡§ø‡§∞‡§ø‡§ï‡•ç‡§§ checks ‡§Ø‡§π ‡§∏‡•Å‡§®‡§ø‡§∂‡•ç‡§ö‡§ø‡§§ ‡§ï‡§∞‡§§‡•á ‡§π‡•à‡§Ç ‡§ï‡§ø ‡§Ü‡§™ ‡§ó‡§≤‡§§ size ‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó‡•ç‡§∏ ‡§ï‡•á ‡§∏‡§æ‡§• ‡§ó‡§≤‡§§‡•Ä ‡§∏‡•á ‡§∞‡§® ‡§® ‡§ï‡§∞‡•á‡§Ç‡•§

stage II ‡§ü‡•ç‡§∞‡•á‡§® ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è, ‡§ä‡§™‡§∞ ‡§¶‡§ø‡§è ‡§ó‡§è ‡§∏‡•ç‡§ü‡•á‡§™‡•ç‡§∏ ‡§ï‡§æ ‡§™‡§æ‡§≤‡§® ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ `MODEL_TYPE` ‡§ï‡•á ‡§≤‡§ø‡§è `deepfloyd-lora` ‡§ï‡•Ä ‡§ú‡§ó‡§π `deepfloyd-stage2-lora` ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡•á‡§Ç:

```bash
export MODEL_TYPE="deepfloyd-stage2-lora"
```
