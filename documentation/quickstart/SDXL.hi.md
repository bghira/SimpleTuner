## Stable Diffusion XL рдХреНрд╡рд┐рдХрд╕реНрдЯрд╛рд░реНрдЯ

рдЗрд╕ рдЙрджрд╛рд╣рд░рдг рдореЗрдВ, рд╣рдо SimpleTuner рдЯреВрд▓рдХрд┐рдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ Stable Diffusion XL рдореЙрдбрд▓ рдкреНрд░рд╢рд┐рдХреНрд╖рдг рдХрд░реЗрдВрдЧреЗ рдФрд░ `lora` рдореЙрдбрд▓ рдЯрд╛рдЗрдк рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗред

рдЖрдзреБрдирд┐рдХ, рдмрдбрд╝реЗ рдореЙрдбрд▓реЛрдВ рдХреА рддреБрд▓рдирд╛ рдореЗрдВ SDXL рдЖрдХрд╛рд░ рдореЗрдВ рдХрд╛рдлреА рдЫреЛрдЯрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП `full` рдкреНрд░рд╢рд┐рдХреНрд╖рдг рд╕рдВрднрд╡ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдЗрд╕рдХреЗ рд▓рд┐рдП LoRA рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рдЕрдзрд┐рдХ VRAM рдФрд░ рдЕрдиреНрдп рд╣рд╛рдЗрдкрд░тАСрдкреИрд░рд╛рдореАрдЯрд░ рд╕рдорд╛рдпреЛрдЬрди рдЪрд╛рд╣рд┐рдП рд╣реЛрдВрдЧреЗред

### рдкреВрд░реНрд╡рд╛рдкреЗрдХреНрд╖рд╛рдПрдБ

рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВ рдХрд┐ Python рдЗрдВрд╕реНрдЯреЙрд▓ рд╣реИ; SimpleTuner 3.10 рд╕реЗ 3.12 рдХреЗ рд╕рд╛рде рдЕрдЪреНрдЫрд╛ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ (AMD ROCm рдорд╢реАрдиреЛрдВ рдХреЛ 3.12 рдЪрд╛рд╣рд┐рдП рд╣реЛрдЧрд╛)ред

рдЖрдк рдЗрд╕реЗ рдЪрд▓рд╛рдХрд░ рдЬрд╛рдВрдЪ рд╕рдХрддреЗ рд╣реИрдВ:

```bash
python --version
```

рдпрджрд┐ рдЖрдкрдХреЗ Ubuntu рдкрд░ Python 3.12 рдЗрдВрд╕реНрдЯреЙрд▓ рдирд╣реАрдВ рд╣реИ, рддреЛ рдЖрдк рдпрд╣ рдкреНрд░рдпрд╛рд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

```bash
apt -y install python3.13 python3.13-venv
```

#### Container image dependencies

Vast, RunPod, рдФрд░ TensorDock (рдЖрджрд┐) рдХреЗ рд▓рд┐рдП, CUDA 12.2тАС12.8 рдЗрдореЗрдЬ рдкрд░ CUDA extensions рдХрдореНрдкрд╛рдЗрд▓ рдХрд░рдиреЗ рд╣реЗрддреБ рдпрд╣ рдХрд╛рдо рдХрд░реЗрдЧрд╛:

```bash
apt -y install nvidia-cuda-toolkit
```

### рдЗрдВрд╕реНрдЯреЙрд▓реЗрд╢рди

pip рдХреЗ рдЬрд░рд┐рдП SimpleTuner рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд░реЗрдВ:

```bash
pip install 'simpletuner[cuda]'

# CUDA 13 / Blackwell users (NVIDIA B-series GPUs)
pip install 'simpletuner[cuda13]'
```

рдореИрдиреБрдЕрд▓ рдЗрдВрд╕реНрдЯреЙрд▓реЗрд╢рди рдпрд╛ рдбреЗрд╡рд▓рдкрдореЗрдВрдЯ рд╕реЗрдЯрдЕрдк рдХреЗ рд▓рд┐рдП, [installation documentation](../INSTALL.md) рджреЗрдЦреЗрдВред

### рд╡рд╛рддрд╛рд╡рд░рдг рд╕реЗрдЯрдЕрдк

SimpleTuner рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рдПрдХ configuration рдлрд╝рд╛рдЗрд▓, dataset рдФрд░ model directories, рддрдерд╛ рдПрдХ dataloader configuration рдлрд╝рд╛рдЗрд▓ рд╕реЗрдЯ рдХрд░рдиреА рд╣реЛрдЧреАред

#### Configuration file

рдПрдХ рдкреНрд░рдпреЛрдЧрд╛рддреНрдордХ рд╕реНрдХреНрд░рд┐рдкреНрдЯ, `configure.py`, рдЗрдВрдЯрд░реИрдХреНрдЯрд┐рд╡ stepтАСbyтАСstep рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреЗ рдЬрд░рд┐рдП рдЗрд╕ рд╕реЗрдХреНрд╢рди рдХреЛ рдкреВрд░реА рддрд░рд╣ рд╕реНрдХрд┐рдк рдХрд░рдиреЗ рдореЗрдВ рдорджрдж рдХрд░ рд╕рдХрддреА рд╣реИред рдЗрд╕рдореЗрдВ рдХреБрдЫ рд╕реБрд░рдХреНрд╖рд╛ рдлреАрдЪрд░реНрд╕ рд╣реИрдВ рдЬреЛ рд╕рд╛рдорд╛рдиреНрдп pitfalls рд╕реЗ рдмрдЪрд╛рддреЗ рд╣реИрдВред

**рдиреЛрдЯ:** рдпрд╣ рдЖрдкрдХреЗ dataloader рдХреЛ **рдкреВрд░реА рддрд░рд╣** рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдирд╣реАрдВ рдХрд░рддрд╛ред рдЖрдкрдХреЛ рдЙрд╕реЗ рдмрд╛рдж рдореЗрдВ рдореИрдиреНрдпреБрдЕрд▓реА рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред

рдЗрд╕реЗ рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП:

```bash
simpletuner configure
```
> тЪая╕П рдЬрд┐рди рджреЗрд╢реЛрдВ рдореЗрдВ Hugging Face Hub рдЖрд╕рд╛рдиреА рд╕реЗ рдЙрдкрд▓рдмреНрдз рдирд╣реАрдВ рд╣реИ, рд╡рд╣рд╛рдБ `HF_ENDPOINT=https://hf-mirror.com` рдХреЛ рдЕрдкрдиреЗ `~/.bashrc` рдпрд╛ `~/.zshrc` рдореЗрдВ рдЬреЛрдбрд╝реЗрдВ, рдпрд╣ рдЖрдкрдХреЗ рд╕рд┐рд╕реНрдЯрдо рдХреЗ `$SHELL` рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддрд╛ рд╣реИред

рдпрджрд┐ рдЖрдк рдореИрдиреНрдпреБрдЕрд▓ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдирд╛ рдкрд╕рдВрдж рдХрд░рддреЗ рд╣реИрдВ:

`config/config.json.example` рдХреЛ `config/config.json` рдореЗрдВ рдХреЙрдкреА рдХрд░реЗрдВ:

```bash
cp config/config.json.example config/config.json
```

#### AMD ROCm followтАСup steps

AMD MI300X рдХреЛ рдЙрдкрдпреЛрдЧреА рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рдореНрди рдЪрд▓рд╛рдирд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реИ:

```bash
apt install amd-smi-lib
pushd /opt/rocm/share/amd_smi
python3 -m pip install --upgrade pip
python3 -m pip install .
popd
```

рдлрд┐рд░, рдЖрдкрдХреЛ рдирд┐рдореНрди рд╡реЗрд░рд┐рдПрдмрд▓реНрд╕ рдмрджрд▓рдиреЗ рд╣реЛрдВрдЧреЗ:

<details>
<summary>рдЙрджрд╛рд╣рд░рдг рдХреЙрдиреНрдлрд╝рд┐рдЧ рджреЗрдЦреЗрдВ</summary>

```json
{
  "model_type": "lora",
  "model_family": "sdxl",
  "model_flavour": "base-1.0",
  "output_dir": "/home/user/output/models",
  "validation_resolution": "1024x1024,1280x768",
  "validation_guidance": 3.4,
  "use_gradient_checkpointing": true,
  "learning_rate": 1e-4
}
```
</details>

- `model_family` - рдЗрд╕реЗ `sdxl` рдкрд░ рд╕реЗрдЯ рдХрд░реЗрдВред
- `model_flavour` - рдЗрд╕реЗ `base-1.0` рдкрд░ рд╕реЗрдЯ рдХрд░реЗрдВ, рдпрд╛ `pretrained_model_name_or_path` рд╕реЗ рдХрд┐рд╕реА рдЕрдиреНрдп рдореЙрдбрд▓ рдкрд░ рдкреЙрдЗрдВрдЯ рдХрд░реЗрдВред
- `model_type` - рдЗрд╕реЗ `lora` рдкрд░ рд╕реЗрдЯ рдХрд░реЗрдВред
- `use_dora` - рдпрджрд┐ рдЖрдк DoRA рдЯреНрд░реЗрди рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рддреЛ `true` рд╕реЗрдЯ рдХрд░реЗрдВред
- `output_dir` - рдЗрд╕реЗ рдЙрд╕ рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рдкрд░ рд╕реЗрдЯ рдХрд░реЗрдВ рдЬрд╣рд╛рдБ рдЖрдк рдЕрдкрдиреЗ checkpoints рдФрд░ validation images рд░рдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВред рдпрд╣рд╛рдБ full path рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рд╕рд▓рд╛рд╣ рд╣реИред
- `validation_resolution` - рдЗрд╕ рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП рдЗрд╕реЗ `1024x1024` рдкрд░ рд╕реЗрдЯ рдХрд░реЗрдВред
  - рд╕рд╛рде рд╣реА, Stable Diffusion XL рдХреЛ multiтАСaspect buckets рдкрд░ fineтАСtune рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛, рдФрд░ рдЕрдиреНрдп resolutions рдХреЛ рдХреЙрдорд╛ рд╕реЗ рдЕрд▓рдЧ рдХрд░ рдХреЗ рджрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ: `1024x1024,1280x768`
- `validation_guidance` - inference рдореЗрдВ рдкрд░реАрдХреНрд╖рдг рдХреЗ рд▓рд┐рдП рдЬрд┐рд╕ рдорд╛рди рдХреЗ рд╕рд╛рде рдЖрдк рд╕рд╣рдЬ рд╣реЛрдВ, рд╡рд╣реА рд░рдЦреЗрдВред рдЗрд╕реЗ `4.2` рд╕реЗ `6.4` рдХреЗ рдмреАрдЪ рд╕реЗрдЯ рдХрд░реЗрдВред
- `use_gradient_checkpointing` - рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдмрд╣реБрдд VRAM рдирд╣реАрдВ рд╣реИ, рддреЛ рдЗрд╕реЗ `true` рд░рдЦреЗрдВред
- `learning_rate` - lowтАСrank рдиреЗрдЯрд╡рд░реНрдХреНрд╕ рдХреЗ рд▓рд┐рдП `1e-4` рд╕рд╛рдорд╛рдиреНрдп рд╣реИ, рд▓реЗрдХрд┐рди рдпрджрд┐ "burning" рдпрд╛ early overtraining рджрд┐рдЦреЗ рддреЛ `1e-5` рдЕрдзрд┐рдХ conservative рд╣реЛ рд╕рдХрддрд╛ рд╣реИред

рдпрджрд┐ рдЖрдк Mac MтАСseries рдорд╢реАрди рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣реЗ рд╣реИрдВ рддреЛ рдХреБрдЫ рдЕрддрд┐рд░рд┐рдХреНрдд рд╕реЗрдЯрд┐рдВрдЧреНрд╕:

- `mixed_precision` рдХреЛ `no` рдкрд░ рд╕реЗрдЯ рдХрд░реЗрдВред
  - рдпрд╣ pytorch 2.4 рдореЗрдВ рд╕рд╣реА рдерд╛, рд▓реЗрдХрд┐рди рд╢рд╛рдпрдж 2.6+ рдореЗрдВ bf16 рдЕрдм рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ
- `attention_mechanism` рдХреЛ `xformers` рдкрд░ рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣ рдЕрдм рд▓рдЧрднрдЧ obsolete рд╣реИред

#### Quantised model training

Apple рдФрд░ NVIDIA рд╕рд┐рд╕реНрдЯрдореНрд╕ рдкрд░ рдЯреЗрд╕реНрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ; Hugging Face OptimumтАСQuanto Unet рдХреА precision рдФрд░ VRAM рдЖрд╡рд╢реНрдпрдХрддрд╛рдУрдВ рдХреЛ рдШрдЯрд╛ рд╕рдХрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣ SD3/Flux рдЬреИрд╕реЗ Diffusion Transformer рдореЙрдбрд▓реЛрдВ рдЬрд┐рддрдирд╛ рдЕрдЪреНрдЫрд╛ рдХрд╛рдо рдирд╣реАрдВ рдХрд░рддрд╛, рдЗрд╕рд▓рд┐рдП рдЕрдиреБрд╢рдВрд╕рд┐рдд рдирд╣реАрдВ рд╣реИред

рдпрджрд┐ рдЖрдкрдХреЗ рд╕рдВрд╕рд╛рдзрди рдмрд╣реБрдд рд╕реАрдорд┐рдд рд╣реИрдВ, рддрдм рднреА рдЗрд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

`config.json` рдХреЗ рд▓рд┐рдП:
<details>
<summary>рдЙрджрд╛рд╣рд░рдг рдХреЙрдиреНрдлрд╝рд┐рдЧ рджреЗрдЦреЗрдВ</summary>

```json
{
  "base_model_precision": "int8-quanto",
  "text_encoder_1_precision": "no_change",
  "text_encoder_2_precision": "no_change",
  "optimizer": "optimi-lion"
}
```
</details>

#### рдЙрдиреНрдирдд рдкреНрд░рдпреЛрдЧрд╛рддреНрдордХ рд╡рд┐рд╢реЗрд╖рддрд╛рдПрдБ

<details>
<summary>рдЙрдиреНрдирдд рдкреНрд░рдпреЛрдЧрд╛рддреНрдордХ рд╡рд┐рд╡рд░рдг рджрд┐рдЦрд╛рдПрдБ</summary>


SimpleTuner рдореЗрдВ рдкреНрд░рдпреЛрдЧрд╛рддреНрдордХ рдлреАрдЪрд░реНрд╕ рд╢рд╛рдорд┐рд▓ рд╣реИрдВ рдЬреЛ рдкреНрд░рд╢рд┐рдХреНрд╖рдг рдХреА рд╕реНрдерд┐рд░рддрд╛ рдФрд░ рдкреНрд░рджрд░реНрд╢рди рдХреЛ рдХрд╛рдлреА рдмреЗрд╣рддрд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЦрд╛рд╕рдХрд░ рдЫреЛрдЯреЗ рдбреЗрдЯрд╛рд╕реЗрдЯреНрд╕ рдпрд╛ SDXL рдЬреИрд╕реА рдкреБрд░рд╛рдиреА рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░ рдХреЗ рд▓рд┐рдПред

*   **[Scheduled Sampling (Rollout)](../experimental/SCHEDULED_SAMPLING.md):** exposure bias рдХрдо рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЖрдЙрдЯрдкреБрдЯ рдЧреБрдгрд╡рддреНрддрд╛ рдмрдврд╝рд╛рддрд╛ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рдкреНрд░рд╢рд┐рдХреНрд╖рдг рдХреЗ рджреМрд░рд╛рди рдореЙрдбрд▓ рдХреЛ рдЕрдкрдиреЗ рдЗрдирдкреБрдЯреНрд╕ рдЦреБрдж рдЬрдирд░реЗрдЯ рдХрд░рдиреЗ рджреЗрддрд╛ рд╣реИред
*   **[Diff2Flow](../experimental/DIFF2FLOW.md):** Flow Matching objective рдХреЗ рд╕рд╛рде SDXL рдХреЛ рдкреНрд░рд╢рд┐рдХреНрд╖рд┐рдд рдХрд░рдиреЗ рджреЗрддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ generation рдХреА straightness рдФрд░ рдЧреБрдгрд╡рддреНрддрд╛ рд╕рдВрднрд╛рд╡рд┐рдд рд░реВрдк рд╕реЗ рдмреЗрд╣рддрд░ рд╣реЛ рд╕рдХрддреА рд╣реИред

> тЪая╕П рдпреЗ рдлреАрдЪрд░реНрд╕ рдкреНрд░рд╢рд┐рдХреНрд╖рдг рдХреЗ рдХрдВрдкреНрдпреВрдЯреЗрд╢рдирд▓ рдУрд╡рд░рд╣реЗрдб рдХреЛ рдмрдврд╝рд╛рддреЗ рд╣реИрдВред

</details>

#### рдбреЗрдЯрд╛рд╕реЗрдЯ рд╡рд┐рдЪрд╛рд░

рдЕрдкрдиреЗ рдореЙрдбрд▓ рдХреЛ рдкреНрд░рд╢рд┐рдХреНрд╖рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рдкреНрдд рдмрдбрд╝рд╛ рдбреЗрдЯрд╛рд╕реЗрдЯ рд╣реЛрдирд╛ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИред рдбреЗрдЯрд╛рд╕реЗрдЯ рдЖрдХрд╛рд░ рдкрд░ рд╕реАрдорд╛рдПрдБ рд╣реИрдВ, рдФрд░ рдЖрдкрдХреЛ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдирд╛ рд╣реЛрдЧрд╛ рдХрд┐ рдЖрдкрдХрд╛ рдбреЗрдЯрд╛рд╕реЗрдЯ рдкрд░реНрдпрд╛рдкреНрдд рдмрдбрд╝рд╛ рд╣реЛред рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдиреНрдпреВрдирддрдо рдбреЗрдЯрд╛рд╕реЗрдЯ рдЖрдХрд╛рд░ `TRAIN_BATCH_SIZE * GRADIENT_ACCUMULATION_STEPS` рд╣реИред рдпрджрд┐ рдбреЗрдЯрд╛рд╕реЗрдЯ рдмрд╣реБрдд рдЫреЛрдЯрд╛ рд╣реИ, рддреЛ рдЯреНрд░реЗрдирд░ рдЙрд╕реЗ discover рдирд╣реАрдВ рдХрд░ рдкрд╛рдПрдЧрд╛ред

> ЁЯТб **рдЯрд┐рдк:** рдмрдбрд╝реЗ рдбреЗрдЯрд╛рд╕реЗрдЯреНрд╕ рдореЗрдВ рдЬрд╣рд╛рдБ рдбрд┐рд╕реНрдХ рд╕реНрдкреЗрд╕ рдЪрд┐рдВрддрд╛ рдХрд╛ рд╡рд┐рд╖рдп рд╣реЛ, рдЖрдк `--vae_cache_disable` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдмрд┐рдирд╛ рдбрд┐рд╕реНрдХ рдХреИрд╢ рдХреЗ online VAE encoding рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдпрд╣ `--vae_cache_ondemand` рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдкрд░ рднреА implicitly рд╕рдХреНрд╖рдо рд░рд╣рддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди `--vae_cache_disable` рдЬреЛрдбрд╝рдиреЗ рд╕реЗ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рд╣реЛрддрд╛ рд╣реИ рдХрд┐ рдбрд┐рд╕реНрдХ рдкрд░ рдХреБрдЫ рднреА рди рд▓рд┐рдЦрд╛ рдЬрд╛рдПред

рдЖрдкрдХреЗ рдбреЗрдЯрд╛рд╕реЗрдЯ рдХреЗ рдЕрдиреБрд╕рд╛рд░, рдЖрдкрдХреЛ рдбреЗрдЯрд╛рд╕реЗрдЯ рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рдФрд░ dataloader configuration рдлрд╝рд╛рдЗрд▓ рдЕрд▓рдЧ рддрд░реАрдХреЗ рд╕реЗ рд╕реЗрдЯ рдХрд░рдиреА рд╣реЛрдЧреАред рдЗрд╕ рдЙрджрд╛рд╣рд░рдг рдореЗрдВ рд╣рдо [pseudo-camera-10k](https://huggingface.co/datasets/bghira/pseudo-camera-10k) рдбреЗрдЯрд╛рд╕реЗрдЯ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗред

рдЕрдкрдиреЗ `OUTPUT_DIR` рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рдореЗрдВ, рдПрдХ multidatabackend.json рдмрдирд╛рдПрдБ:

<details>
<summary>рдЙрджрд╛рд╣рд░рдг рдХреЙрдиреНрдлрд╝рд┐рдЧ рджреЗрдЦреЗрдВ</summary>

```json
[
  {
    "id": "pseudo-camera-10k-sdxl",
    "type": "local",
    "crop": true,
    "crop_aspect": "square",
    "crop_style": "random",
    "resolution": 1.0,
    "minimum_image_size": 0.25,
    "maximum_image_size": 1.0,
    "target_downsample_size": 1.0,
    "resolution_type": "area",
    "cache_dir_vae": "cache/vae/sdxl/pseudo-camera-10k",
    "instance_data_dir": "/home/user/simpletuner/datasets/pseudo-camera-10k",
    "disabled": false,
    "skip_file_discovery": "",
    "caption_strategy": "filename",
    "metadata_backend": "discovery"
  },
  {
    "id": "text-embeds",
    "type": "local",
    "dataset_type": "text_embeds",
    "default": true,
    "cache_dir": "cache/text/sdxl/pseudo-camera-10k",
    "disabled": false,
    "write_batch_size": 128
  }
]
```
</details>

> `caption_strategy` рд╡рд┐рдХрд▓реНрдк рдФрд░ рдЖрд╡рд╢реНрдпрдХрддрд╛рдУрдВ рдХреЗ рд▓рд┐рдП [DATALOADER.md](../DATALOADER.md#caption_strategy) рджреЗрдЦреЗрдВред

рдлрд┐рд░, рдПрдХ `datasets` рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рдмрдирд╛рдПрдБ:

```bash
mkdir -p datasets
huggingface-cli download --repo-type=dataset bghira/pseudo-camera-10k --local-dir=datasets/pseudo-camera-10k
```

рдпрд╣ рд▓рдЧрднрдЧ 10k рдлреЛрдЯреЛрдЧреНрд░рд╛рдл рд╕реИрдВрдкрд▓реНрд╕ рдХреЛ рдЖрдкрдХреА `datasets/pseudo-camera-10k` рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдЧрд╛, рдЬреЛ рдЕрдкрдиреЗтАСрдЖрдк рдмрди рдЬрд╛рдПрдЧреАред

#### WandB рдФрд░ Huggingface Hub рдореЗрдВ рд▓реЙрдЧтАСрдЗрди

рдкреНрд░рд╢рд┐рдХреНрд╖рдг рд╢реБрд░реВ рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ WandB рдФрд░ HF Hub рдореЗрдВ рд▓реЙрдЧтАСрдЗрди рдХрд░рдирд╛ рдмреЗрд╣рддрд░ рд╣реИ, рдЦрд╛рд╕рдХрд░ рдпрджрд┐ рдЖрдк `push_to_hub: true` рдФрд░ `--report_to=wandb` рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣реЗ рд╣реИрдВред

рдпрджрд┐ рдЖрдк Git LFS рд░рд┐рдкреЙрдЬрд╝рд┐рдЯрд░реА рдореЗрдВ рдореИрдиреНрдпреБрдЕрд▓реА рдЖрдЗрдЯрдореНрд╕ push рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рд╣реИрдВ, рддреЛ `git config --global credential.helper store` рднреА рдЪрд▓рд╛рдПрдБред

рдирд┐рдореНрди рдХрдорд╛рдВрдб рдЪрд▓рд╛рдПрдБ:

```bash
wandb login
```

рдФрд░

```bash
huggingface-cli login
```

рдирд┐рд░реНрджреЗрд╢реЛрдВ рдХрд╛ рдкрд╛рд▓рди рдХрд░рдХреЗ рджреЛрдиреЛрдВ рд╕реЗрд╡рд╛рдУрдВ рдореЗрдВ рд▓реЙрдЧтАСрдЗрди рдХрд░реЗрдВред

### рдкреНрд░рд╢рд┐рдХреНрд╖рдг рд░рди рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдирд╛

SimpleTuner рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рд╕реЗ, рдмрд╕ рдпрд╣ рдЪрд▓рд╛рдПрдБ:

```bash
bash train.sh
```

рдЗрд╕рд╕реЗ text embed рдФрд░ VAE рдЖрдЙрдЯрдкреБрдЯ рдХреИрд╢рд┐рдВрдЧ рдбрд┐рд╕реНрдХ рдкрд░ рд╢реБрд░реВ рд╣реЛрдЧреАред

рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП [dataloader](../DATALOADER.md) рдФрд░ [tutorial](../TUTORIAL.md) рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рджреЗрдЦреЗрдВред

### CLIP score рдЯреНрд░реИрдХрд┐рдВрдЧ

рдпрджрд┐ рдЖрдк рдореЙрдбрд▓ рдкреНрд░рджрд░реНрд╢рди рд╕реНрдХреЛрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП evaluations рд╕рдХреНрд╖рдо рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рддреЛ CLIP scores рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдФрд░ рдЗрдВрдЯрд░рдкреНрд░реЗрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП [рдпрд╣ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝](../evaluation/CLIP_SCORES.md) рджреЗрдЦреЗрдВред

# рд╕реНрдерд┐рд░ evaluation loss

рдпрджрд┐ рдЖрдк рдореЙрдбрд▓ рдкреНрд░рджрд░реНрд╢рди рд╕реНрдХреЛрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП stable MSE loss рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рддреЛ evaluation loss рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдФрд░ рдЗрдВрдЯрд░рдкреНрд░реЗрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП [рдпрд╣ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝](../evaluation/EVAL_LOSS.md) рджреЗрдЦреЗрдВред

#### Validation previews

SimpleTuner Tiny AutoEncoder рдореЙрдбрд▓реЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ generation рдХреЗ рджреМрд░рд╛рди intermediate validation previews рд╕реНрдЯреНрд░реАрдо рдХрд░рдиреЗ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИред рдЗрд╕рд╕реЗ рдЖрдк webhook callbacks рдХреЗ рдЬрд░рд┐рдП realтАСtime рдореЗрдВ stepтАСbyтАСstep validation images рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВред

рд╕рдХреНрд░рд┐рдп рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП:
<details>
<summary>рдЙрджрд╛рд╣рд░рдг рдХреЙрдиреНрдлрд╝рд┐рдЧ рджреЗрдЦреЗрдВ</summary>

```json
{
  "validation_preview": true,
  "validation_preview_steps": 1
}
```
</details>

**рдЖрд╡рд╢реНрдпрдХрддрд╛рдПрдБ:**
- Webhook configuration
- Validation рд╕рдХреНрд╖рдо рд╣реЛрдирд╛

`validation_preview_steps` рдХреЛ рдКрдБрдЪрд╛ рдорд╛рди (рдЬреИрд╕реЗ 3 рдпрд╛ 5) рд░рдЦреЗрдВ рддрд╛рдХрд┐ Tiny AutoEncoder рдХрд╛ рдУрд╡рд░рд╣реЗрдб рдХрдо рд╣реЛред `validation_num_inference_steps=20` рдФрд░ `validation_preview_steps=5` рдХреЗ рд╕рд╛рде, рдЖрдкрдХреЛ steps 5, 10, 15, рдФрд░ 20 рдкрд░ preview images рдорд┐рд▓реЗрдВрдЧреАред
