{% set repo_field = section_fields | selectattr('id', 'equalto', 'hub_model_id') | first %}
{% if repo_field %}
<div class="col-12">
    <div class="hf-repo-selector"
         x-data='hfRepoSelector.init("{{ repo_field.id }}", {{ repo_field.value | default('') | tojson }})'
         x-init="initialize()"
         x-on:token-updated.window="loadNamespaces(true)">
        <input type="hidden"
               x-ref="hiddenField"
               id="{{ repo_field.id }}"
               name="{{ repo_field.name }}"
               x-bind:value="fullRepo">

        <div class="hf-repo-selector__heading">
            <div class="hf-repo-selector__title">
                Full repository identifier on Hugging Face Hub <span class="text-muted">(namespace/model)</span>
            </div>
            <p class="hf-repo-selector__subtitle text-muted mb-0">
                Combine your namespace with the destination repository name, or type <code>namespace/repo</code> to set both.
            </p>
            {% if repo_field.description %}
            <p class="hf-repo-selector__description text-muted mb-0">{{ repo_field.description }}</p>
            {% endif %}
        </div>

        <div class="row g-3 align-items-end hf-repo-selector__row">
            <div class="col-lg-5">
                <label class="form-label">Namespace</label>
                <div class="hf-repo-selector__input-group">
                    <select class="form-select"
                            x-model="selectedNamespace"
                            @change="updateFullRepo"
                            :disabled="loading">
                        <option value="" x-show="loading" selected x-cloak>Loadingâ€¦</option>
                        <option value="" x-show="!loading && namespaces.length === 0" x-cloak>Login to load namespaces</option>
                        <option x-show="selectedNamespace && !namespaces.includes(selectedNamespace)"
                                x-bind:value="selectedNamespace"
                                x-text="selectedNamespace"
                                x-cloak></option>
                        <template x-for="namespace in namespaces" :key="namespace">
                            <option :value="namespace" x-text="namespace"></option>
                        </template>
                    </select>
                    <button type="button"
                            class="btn btn-outline-secondary btn-icon"
                            :disabled="loading"
                            @click.prevent="loadNamespaces(true)">
                        <i class="fas fa-sync-alt" :class="{ 'fa-spin': loading }"></i>
                    </button>
                </div>
                <div class="form-text mt-2">
                    Namespaces come from your Hugging Face user and organisations.
                </div>
                <div class="text-danger small mt-2" x-text="error" x-show="error" x-cloak></div>
            </div>
            <div class="col-lg-7">
                <label class="form-label">Repository name</label>
                <input type="text"
                       class="form-control"
                       placeholder="{{ repo_field.placeholder or 'model-name' }}"
                       x-model="repoName"
                       @input="onRepoInput">
            </div>
        </div>

        <div class="hf-repo-selector__result">
            <div class="hf-repo-selector__result-label text-uppercase text-muted">Full repository</div>
            <code class="hf-repo-selector__result-value" x-text="fullRepo || 'namespace/model-name'"></code>
            <button type="button"
                    class="btn btn-sm btn-outline-info d-flex align-items-center gap-2"
                    @click.prevent="checkAvailability"
                    :disabled="!fullRepo || checking">
                <i class="fas fa-search" :class="{ 'fa-spin': checking }"></i>
                <span>Check availability</span>
            </button>
        </div>

        <div class="hf-repo-selector__status"
             x-show="checkStatusMessage"
             x-cloak
             :class="statusClass"
             x-text="checkStatusMessage"></div>
    </div>
</div>
{% endif %}

{% for field_dict in section_fields if field_dict.id != 'hub_model_id' %}
    {% set field = field_dict %}
    {% include 'partials/form_field_htmx.html' %}
{% endfor %}
