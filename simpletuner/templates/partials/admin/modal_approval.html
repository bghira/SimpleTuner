<!-- Approval Rule Form Modal -->
<div class="modal fade" :class="{ 'show d-block': approvalRuleFormOpen }" tabindex="-1"
     x-show="approvalRuleFormOpen" @keydown.escape="approvalRuleFormOpen = false">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content bg-dark">
            <div class="modal-header border-secondary py-2">
                <h6 class="modal-title" x-text="editingApprovalRule ? 'Edit Approval Rule' : 'Create Approval Rule'"></h6>
                <button type="button" class="btn-close btn-close-white" @click="approvalRuleFormOpen = false"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label class="form-label small">Name</label>
                    <input type="text" class="form-control form-control-sm bg-dark text-light border-secondary"
                           x-model="approvalRuleForm.name" required placeholder="e.g., High Cost Jobs">
                </div>
                <div class="row mb-3">
                    <div class="col-6">
                        <label class="form-label small">Trigger Type</label>
                        <select class="form-select form-select-sm bg-dark text-light border-secondary" x-model="approvalRuleForm.trigger_type">
                            <template x-if="approvalConditions.length > 0">
                                <template x-for="cond in approvalConditions" :key="cond.value">
                                    <option :value="cond.value" x-text="cond.description || cond.label"></option>
                                </template>
                            </template>
                            <template x-if="approvalConditions.length === 0">
                                <!-- Fallback static options (all 7 conditions) -->
                                <option value="cost_exceeds">Cost Exceeds ($)</option>
                                <option value="hardware_type">Hardware Type</option>
                                <option value="provider">Cloud Provider</option>
                                <option value="user_level">User Level Below</option>
                                <option value="daily_jobs_exceed">Daily Jobs Exceed</option>
                                <option value="first_job">First Job</option>
                                <option value="config_pattern">Config Pattern</option>
                            </template>
                        </select>
                    </div>
                    <div class="col-6">
                        <label class="form-label small">Threshold Value</label>
                        <input type="text" class="form-control form-control-sm bg-dark text-light border-secondary"
                               x-model="approvalRuleForm.trigger_value" placeholder="e.g., 50 or gpu-a100*">
                    </div>
                </div>
                <div class="mb-3">
                    <label class="form-label small">Required Approver Level</label>
                    <select class="form-select form-select-sm bg-dark text-light border-secondary" x-model="approvalRuleForm.required_level">
                        <template x-for="level in levels" :key="level.id">
                            <option :value="level.name" x-text="level.name"></option>
                        </template>
                        <option value="admin">admin</option>
                    </select>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="approval-rule-enabled" x-model="approvalRuleForm.enabled">
                    <label class="form-check-label small" for="approval-rule-enabled">Enabled</label>
                </div>
            </div>
            <div class="modal-footer border-secondary py-2">
                <button type="button" class="btn btn-secondary btn-sm" @click="approvalRuleFormOpen = false">Cancel</button>
                <button type="button" class="btn btn-primary btn-sm" @click="saveApprovalRule()" :disabled="saving">
                    <i class="fas fa-spinner fa-spin me-1" x-show="saving"></i>
                    <span x-text="editingApprovalRule ? 'Update' : 'Create'"></span>
                </button>
            </div>
        </div>
    </div>
</div>
<div class="modal-backdrop fade show" x-show="approvalRuleFormOpen" @click="approvalRuleFormOpen = false"></div>
