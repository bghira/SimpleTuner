<!-- Admin - Auth Providers Tab -->
<div x-show="activeTab === 'auth'" x-transition>
    <!-- Auth Hint -->
    <div class="admin-hint admin-hint-inline" x-show="hints.auth" x-transition>
        <div class="d-flex justify-content-between align-items-start">
            <div class="small">
                <div class="d-flex align-items-start mb-2">
                    <i class="fas fa-lightbulb text-warning me-2 mt-1"></i>
                    <strong>External Authentication Providers</strong>
                </div>
                <p class="mb-2">
                    Connect identity providers for single sign-on. Users are auto-provisioned on first login
                    with default level "researcher". Configure group/role mapping to assign levels automatically.
                </p>
                <div class="row g-3">
                    <div class="col-md-6">
                        <strong>OIDC Providers:</strong>
                        <ul class="mb-0 ps-3 mt-1">
                            <li>Keycloak</li>
                            <li>Auth0</li>
                            <li>Okta</li>
                            <li>Azure AD</li>
                            <li>Google</li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <strong>LDAP Providers:</strong>
                        <ul class="mb-0 ps-3 mt-1">
                            <li>Active Directory</li>
                            <li>OpenLDAP</li>
                        </ul>
                    </div>
                </div>
            </div>
            <button class="btn btn-sm btn-link text-muted p-0 ms-2" @click="dismissHint('auth')"><i class="fas fa-times"></i></button>
        </div>
    </div>

    <div class="admin-toolbar">
        <div class="d-flex gap-2">
            <div class="dropdown">
                <button class="btn btn-sm btn-primary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                    <i class="fas fa-plus me-1"></i>Add Provider
                </button>
                <ul class="dropdown-menu dropdown-menu-dark">
                    <li><a class="dropdown-item" href="#" @click.prevent="showCreateAuthProviderForm('oidc')">
                        <i class="fab fa-openid me-2"></i>OIDC Provider
                    </a></li>
                    <li><a class="dropdown-item" href="#" @click.prevent="showCreateAuthProviderForm('ldap')">
                        <i class="fas fa-sitemap me-2"></i>LDAP / Active Directory
                    </a></li>
                </ul>
            </div>
        </div>
    </div>

    <div class="admin-table-container">
        <table class="table table-dark table-hover mb-0">
            <thead>
                <tr>
                    <th>Provider</th>
                    <th>Type</th>
                    <th class="d-none d-md-table-cell">Endpoint</th>
                    <th style="width: 80px;">Status</th>
                    <th style="width: 150px;">Actions</th>
                </tr>
            </thead>
            <tbody>
                <template x-if="authProvidersLoading">
                    <tr><td colspan="5" class="text-center py-4"><i class="fas fa-spinner fa-spin me-2"></i>Loading...</td></tr>
                </template>
                <template x-if="!authProvidersLoading && authProviders.length === 0">
                    <tr>
                        <td colspan="5" class="text-center py-4 text-muted">
                            <i class="fas fa-key me-2"></i>No external auth providers configured
                            <div class="mt-2 small">Users log in with local accounts only</div>
                        </td>
                    </tr>
                </template>
                <template x-for="provider in authProviders" :key="provider.id">
                    <tr :class="{ 'opacity-50': !provider.enabled }">
                        <td>
                            <div class="fw-medium" x-text="provider.name"></div>
                        </td>
                        <td>
                            <span class="badge bg-info">
                                <i class="fas me-1" :class="getAuthProviderIcon(provider.provider_type)"></i>
                                <span x-text="(provider.provider_type || '').toUpperCase()"></span>
                            </span>
                        </td>
                        <td class="d-none d-md-table-cell">
                            <code class="small text-truncate d-inline-block" style="max-width: 250px;"
                                  x-text="provider.config?.issuer_url || provider.config?.server_url || '-'"></code>
                        </td>
                        <td>
                            <span class="badge" :class="provider.enabled ? 'bg-success' : 'bg-secondary'"
                                  x-text="provider.enabled ? 'Active' : 'Disabled'"></span>
                        </td>
                        <td>
                            <div class="btn-group btn-group-sm">
                                <button class="btn btn-outline-info" @click="testAuthProvider(provider)" title="Test Connection">
                                    <i class="fas fa-plug"></i>
                                </button>
                                <button class="btn btn-outline-primary" @click="showEditAuthProviderForm(provider)" title="Edit">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-outline-danger" @click="deleteAuthProvider(provider)" title="Delete">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                </template>
            </tbody>
        </table>
    </div>

    <!-- Credential Security Settings -->
    <div class="card bg-dark border-secondary m-3">
        <div class="card-header border-secondary py-2 d-flex justify-content-between align-items-center"
             data-bs-toggle="collapse" data-bs-target="#credentialSecuritySettings" style="cursor: pointer;">
            <h6 class="mb-0"><i class="fas fa-shield-alt me-2"></i>Credential Security</h6>
            <i class="fas fa-chevron-down"></i>
        </div>
        <div class="collapse" id="credentialSecuritySettings">
            <div class="card-body">
                <p class="small text-muted mb-3">
                    Configure security policies for API tokens and provider credentials.
                    Stale credentials are flagged in the system status.
                </p>
                <div class="row g-3">
                    <div class="col-md-4">
                        <label class="form-label small">Rotation Threshold (days)</label>
                        <input type="number"
                               class="form-control form-control-sm bg-dark text-light border-secondary"
                               x-model.number="credentialSettings.stale_threshold_days"
                               min="7" max="365"
                               placeholder="90">
                        <div class="form-text text-muted small">
                            Credentials older than this are flagged as stale
                        </div>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label small">Early Warning</label>
                        <div class="form-check form-switch mt-1">
                            <input type="checkbox" class="form-check-input" id="earlyWarningEnabled"
                                   x-model="credentialSettings.early_warning_enabled">
                            <label class="form-check-label small" for="earlyWarningEnabled">
                                Show warnings before expiry
                            </label>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label small">Warning at %</label>
                        <input type="number"
                               class="form-control form-control-sm bg-dark text-light border-secondary"
                               x-model.number="credentialSettings.early_warning_percent"
                               min="50" max="95"
                               :disabled="!credentialSettings.early_warning_enabled"
                               placeholder="75">
                        <div class="form-text text-muted small">
                            Warn when this % of threshold has passed
                        </div>
                    </div>
                </div>
                <div class="mt-3">
                    <button type="button" class="btn btn-sm btn-primary"
                            @click="saveCredentialSettings()"
                            :disabled="savingCredentialSettings">
                        <i class="fas" :class="savingCredentialSettings ? 'fa-spinner fa-spin' : 'fa-save'"></i>
                        <span class="ms-1">Save</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Login Info Card -->
    <div class="card bg-dark border-secondary m-3">
        <div class="card-header border-secondary py-2">
            <h6 class="mb-0"><i class="fas fa-sign-in-alt me-2"></i>Login Information</h6>
        </div>
        <div class="card-body small">
            <div class="row">
                <div class="col-md-6">
                    <strong>Login URL:</strong> <code>/login</code><br>
                    <strong>Logout URL:</strong> <code>/logout</code><br>
                    <strong>API Key Header:</strong> <code>X-API-Key: st_...</code>
                </div>
                <div class="col-md-6">
                    <strong>Session Duration:</strong> 24 hours (30 days with "remember me")<br>
                    <strong>API Key Format:</strong> <code>st_</code> prefix + 32 random chars
                </div>
            </div>
        </div>
    </div>
</div>
