<!-- Credentials Modal -->
<div class="modal fade" :class="{ 'show d-block': credentialsModalOpen }" tabindex="-1"
     x-show="credentialsModalOpen" @keydown.escape="closeCredentialsModal()">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content bg-dark">
            <div class="modal-header border-secondary py-2">
                <h6 class="modal-title">
                    <i class="fas fa-key me-2"></i>Credentials for
                    <span x-text="credentialsUser?.username || credentialsUser?.email"></span>
                </h6>
                <button type="button" class="btn-close btn-close-white" @click="closeCredentialsModal()"></button>
            </div>
            <div class="modal-body">
                <!-- Loading -->
                <div class="text-center py-3" x-show="credentialsLoading">
                    <i class="fas fa-spinner fa-spin me-2"></i>Loading credentials...
                </div>

                <!-- Empty state -->
                <div class="text-center text-muted py-3" x-show="!credentialsLoading && userCredentials.length === 0">
                    <i class="fas fa-key-skeleton me-2"></i>No credentials found for this user
                </div>

                <!-- Credentials table -->
                <div class="table-responsive" x-show="!credentialsLoading && userCredentials.length > 0">
                    <table class="table table-dark table-hover mb-0">
                        <thead>
                            <tr>
                                <th>Provider</th>
                                <th>Name/Type</th>
                                <th>Last Updated</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <template x-for="cred in userCredentials" :key="cred.id">
                                <tr :class="{
                                    'table-danger': cred.is_stale,
                                    'table-warning': !cred.is_stale && cred.is_approaching_expiry
                                }">
                                    <td>
                                        <span class="badge bg-info" x-text="cred.provider || 'local'"></span>
                                    </td>
                                    <td x-text="cred.name || cred.credential_type || '-'"></td>
                                    <td class="small text-muted" x-text="getCredentialAge(cred)"></td>
                                    <td>
                                        <span class="badge"
                                              :class="{
                                                  'bg-danger': cred.is_stale,
                                                  'bg-warning text-dark': !cred.is_stale && cred.is_approaching_expiry,
                                                  'bg-success': !cred.is_stale && !cred.is_approaching_expiry
                                              }"
                                              x-text="cred.is_stale ? 'Stale' : (cred.is_approaching_expiry ? 'Expiring' : 'Active')"></span>
                                    </td>
                                    <td>
                                        <button class="btn btn-sm btn-outline-warning"
                                                @click="confirmRotateCredential(cred)"
                                                :disabled="rotating"
                                                title="Rotate this credential">
                                            <i class="fas fa-sync-alt"></i>
                                        </button>
                                    </td>
                                </tr>
                            </template>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer border-secondary py-2">
                <button type="button" class="btn btn-outline-danger btn-sm"
                        @click="rotateAllCredentials()"
                        :disabled="rotating || userCredentials.length === 0">
                    <i class="fas me-1" :class="rotating ? 'fa-spinner fa-spin' : 'fa-sync-alt'"></i>
                    Rotate All
                </button>
                <button type="button" class="btn btn-secondary btn-sm" @click="closeCredentialsModal()">Close</button>
            </div>
        </div>
    </div>
</div>
<div class="modal-backdrop fade show" x-show="credentialsModalOpen" @click="closeCredentialsModal()"></div>

<!-- Rotate Confirmation Modal -->
<div class="modal fade" :class="{ 'show d-block': rotateConfirmOpen }" tabindex="-1"
     x-show="rotateConfirmOpen" @keydown.escape="cancelRotate()" style="z-index: 1060;">
    <div class="modal-dialog modal-dialog-centered modal-sm">
        <div class="modal-content bg-dark">
            <div class="modal-header border-secondary py-2">
                <h6 class="modal-title"><i class="fas fa-exclamation-triangle text-warning me-2"></i>Confirm Rotation</h6>
                <button type="button" class="btn-close btn-close-white" @click="cancelRotate()"></button>
            </div>
            <div class="modal-body">
                <p class="mb-2">Rotate credential:</p>
                <code class="d-block small bg-secondary bg-opacity-25 p-2 rounded"
                      x-text="rotatingCredential?.name || rotatingCredential?.credential_type"></code>
                <p class="small text-warning mt-2 mb-0">
                    <i class="fas fa-warning me-1"></i>This will invalidate the current credential.
                </p>
            </div>
            <div class="modal-footer border-secondary py-2">
                <button type="button" class="btn btn-secondary btn-sm" @click="cancelRotate()">Cancel</button>
                <button type="button" class="btn btn-warning btn-sm" @click="rotateCredential()" :disabled="rotating">
                    <i class="fas me-1" :class="rotating ? 'fa-spinner fa-spin' : 'fa-sync-alt'"></i>
                    Rotate
                </button>
            </div>
        </div>
    </div>
</div>
<div class="modal-backdrop fade show" x-show="rotateConfirmOpen" @click="cancelRotate()" style="z-index: 1055;"></div>
